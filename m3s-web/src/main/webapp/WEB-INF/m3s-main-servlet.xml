<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!--  Configuration of the controller beans -->
<beans>

  <!-- view reolver -->
  <bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
  	<property name="viewClass" value="org.springframework.web.servlet.view.tiles.TilesJstlView"/>
  </bean>  

  <!-- home page -->
  <bean name="/home.html" class="org.inbio.m3s.web.controller.HomePageController">
    <property name="metadataOutputMediaList" value="outputMediaList"/>
    <!-- Statistical Info -->
    <property name="metadataMultimediaCount" value="multimediaCount"/>
    <property name="metadataImagesCount" value="imagesCount"/>
    <property name="metadataVideosCount" value="videosCount"/>

    <!-- daos,managers,dto/service -->
    <property name="mediaDAO" ref="mediaDAO"/>
    <property name="statisticsManager" ref="statisticsManager"/>
    <!-- ARA 
    <property name="briefMediaOutputDTOFactory" ref="ARABriefMediaOutputDTOFactory"/>
    -->
    <!-- ATTA-->
    <property name="briefMediaOutputDTOFactory" ref="ATTABriefMediaOutputDTOFactory"/>  
  </bean>
  
  
  <!-- insert page -->
  <bean name="/insert.html" class="org.inbio.m3s.web.controller.reusable.SimpleFormController">
    <property name="viewName" value="insertStep1"/>
    <property name="formActionValue" value="uploadFile.html"/>
  </bean>
  
  <!--  save image -->
  <bean name="/saveImage.html" class="org.inbio.m3s.web.controller.SaveImagePageController">
    <!-- View -->
    <property name="viewName" value="insertStep2"/>
    <property name="formActionValue" value="saveMetadata.html"/>
    
    <!--  Owner Widget configuration -->
    <property name="mediaOwnerFilters" ref="mediaOwnerFilters"/>
    <property name="mediaOwnerFiltersRequestKey" value="mediaOwnerFilters"/>
    
    <!-- Managers  -->  
    <property name="messageManager" ref="messageManager"/>
    <!--  -->
    <property name="metadataFileName" value="fileName"/>
    <property name="metadataMediaId" value="mediaId"/>
    <property name="metadataMediaVisible" value="mediaVisible"/>
  </bean>
  
  <!--  excell -->
  <bean name="/excel.html" class="org.inbio.m3s.web.controller.ExcelImportController">
    <!-- View -->
    <property name="viewName" value="insertStep2Excel"/>
    <!--data  -->
    <property name="tempFilePath" value="/var/www/lucina.inbio.ac.cr/webapps/m3sINBioFiles/TEMP_MEDIA_DIR/"/>
    <property name="importFilePath" value="/var/www/lucina.inbio.ac.cr/webapps/m3sINBioFiles/IMPORT_FILES/"/>
    <property name="metadataFileName" value="fileName"/>
    <property name="metadataUsername" value="username"/>

    <!-- Managers  -->  
    <property name="importationManager" ref="importationManager"/>  
    <!--  de ARA
    <property name="importThread" ref="ARAImportThread"/>
    -->
    <!--  de ATTA--> 
    <property name="importThread" ref="ATTAImportThread"/>
    
  </bean>
  
  <!-- edit page -->
  <bean name="/edit.html" class="org.inbio.m3s.web.controller.reusable.SimpleController">
    <property name="viewName" value="editStep1"/>
  </bean>
  <!-- edit page -->
  <bean name="/editMedia.html" class="org.inbio.m3s.web.controller.EditStep2PageController">
    <!-- View -->
    <property name="viewName" value="editStep2"/>
    <!--  Form Action -->
    <property name="formActionValue" value="updateMetadata.html"/>
  	<!--  metadata -->
  	<property name="metadataUsername" value="username"/>
    <property name="metadataId" value="mediaId"/>
    <property name="metadataTitle" value="title"/>  
    <property name="metadataDescription" value="description"/>
    <property name="metadataMediaCategory" value="mediaCategories"/>
    <property name="metadataProjects" value="projects"/>
    <property name="metadataKeywords" value="keywords"/>
    <property name="metadataAssociatedToValueType" value="associatedToValueType"/>
    <property name="metadataAssociatedToValue" value="associatedToValue"/>
    <property name="metadataTaxonomy" value="taxonomy"/>
    <property name="metadataSiteDescription" value="siteDescription"/>
    <property name="metadataMediaAuthor" value="mediaAuthor"/>    
    <property name="metadataOwnerType" value="ownerType"/>
    <property name="metadataOwnerValue" value="ownerValue"/>
    <property name="metadataUsePolicy" value="usePolicy"/>
    <property name="metadataMediaVisible" value="mediaVisible"/>
    
    <!--  Owner Widget configuration -->
    <property name="mediaOwnerFilters" ref="mediaOwnerFilters"/>
    <property name="mediaOwnerFiltersRequestKey" value="mediaOwnerFilters"/>
    
    <!-- Converters  -->
    <property name="taxonGuiOrDTOConverter" ref="taxonGuiOrDTOConverter"/>
    
    <!-- Managers  -->  
    <property name="messageManager" ref="messageManager"/>	
    <!-- ARA
    <property name="mediaManager" ref="ARAMediaManager"/>
    <property name="taxonomyManager" ref="ARATaxonomyManager"/>
    <property name="agentManager" ref="ARAAgentManager"/>
    -->
    <!-- ATTA --> 
    <property name="mediaManager" ref="ATTAMediaManager"/>
    <property name="taxonomyManager" ref="ATTATaxonomyManager"/>
    <property name="agentManager" ref="ATTAAgentManager"/>
    
  </bean>
  
  <!--  updates the edited metadata -->
  <bean name="/updateMetadata.html" class="org.inbio.m3s.web.controller.UpdateMetadataController">
    <!-- View -->
    <property name="viewName" value="editStep3"/>
    <property name="formActionValue" value="uploadFile.html"/>
    <property name="metadataUsername" value="username"/>
    <property name="fileNameCode" value="fileName"/>
    <property name="metadataTitle" value="title"/>  
    <property name="metadataDescription" value="description"/>
    <property name="metadataMediaCategory" value="mediaCategories"/>
    <property name="metadataProjects" value="projects"/>
    <property name="metadataKeywords" value="keywords"/>
    <property name="metadataAssociatedToValueType" value="associatedToValueType"/>
    <property name="metadataAssociatedToValue" value="associatedToValue"/>
    <property name="metadataTaxonomy" value="taxonomy"/>
    <property name="metadataSiteDescription" value="siteDescription"/>
    <property name="metadataMediaAuthor" value="mediaAuthor"/>
    <property name="metadataOwnerType" value="ownerType"/>
    <property name="metadataOwnerValue" value="ownerValue"/>
    <property name="metadataUsePolicy" value="usePolicy"/>
    <property name="metadataMediaVisible" value="mediaVisible"/>  
    
    <!-- Converters  -->
    <property name="taxonGuiOrDTOConverter" ref="taxonGuiOrDTOConverter"/>
    <property name="metadataHandler" ref="metadataHandler"/>
    
      
    <!-- Managers -->
    <property name="metadataManager" ref="metadataManager"/>
    <property name="messageManager" ref="messageManager"/>
    <!-- ATTA -->  
    <property name="mediaManager" ref="ATTAMediaManager"/>    
    <property name="agentManager" ref="ATTAAgentManager"/>
    <property name="taxonomyManager" ref="ATTATaxonomyManager"/>
    <property name="siteManager" ref="ATTASiteManager"/>
    <property name="siteDAO" ref="INBioSiteDAO"/>
    
    <!--  de ARA 
    <property name="mediaManager" ref="ARAMediaManager"/>
    <property name="agentManager" ref="ARAAgentManager"/>
    <property name="taxonomyManager" ref="ARATaxonomyManager"/>
    <property name="siteManager" ref="ARASiteManager"/>
    <property name="siteDAO" ref="ARASiteDAO"/>
    -->
  </bean>
  
  <!--  save metadata when media is new -->
  <bean name="/saveMetadata.html" class="org.inbio.m3s.web.controller.SaveMetadataController">
    <!-- View -->
    <property name="viewName" value="insertStep3"/>
    <property name="filePath" value="/usr/share/tomcat5.5/webapps/m3sINBioFiles/TEMP_MEDIA_DIR/"/>
    <property name="metadataUsername" value="username"/>
    <property name="fileNameCode" value="fileName"/>
    <property name="metadataTitle" value="title"/>  
    <property name="metadataDescription" value="description"/>
    <property name="metadataMediaCategory" value="mediaCategories"/>
    <property name="metadataProjects" value="projects"/>
    <property name="metadataKeywords" value="keywords"/>
    <property name="metadataAssociatedToValueType" value="associatedToValueType"/>
    <property name="metadataAssociatedToValue" value="associatedToValue"/>
    <property name="metadataTaxonomy" value="taxonomy"/>
    <property name="metadataSiteDescription" value="siteDescription"/>
    <property name="metadataMediaAuthor" value="mediaAuthor"/>
    <property name="metadataOwnerType" value="ownerType"/>
    <property name="metadataOwnerValue" value="ownerValue"/>
    <property name="metadataUsePolicy" value="usePolicy"/>
    <property name="metadataMediaVisible" value="mediaVisible"/>
    
    <!-- Converters  -->
    <property name="taxonGuiOrDTOConverter" ref="taxonGuiOrDTOConverter"/>
    <property name="metadataHandler" ref="metadataHandler"/>
        
    <!-- Managers -->
    <property name="metadataManager" ref="metadataManager"/>
    <property name="messageManager" ref="messageManager"/>
    
    <!-- ATTA --> 
    <property name="mediaManager" ref="ATTAMediaManager"/>    
    <property name="agentManager" ref="ATTAAgentManager"/>
    <property name="taxonomyManager" ref="ATTATaxonomyManager"/>
    <property name="siteManager" ref="ATTASiteManager"/>
    <property name="siteDAO" ref="INBioSiteDAO"/>
    
    <!-- ARA 
    <property name="mediaManager" ref="ARAMediaManager"/>
    <property name="agentManager" ref="ARAAgentManager"/>
    <property name="taxonomyManager" ref="ARATaxonomyManager"/>
    <property name="siteManager" ref="ARASiteManager"/>
    <property name="siteDAO" ref="ARASiteDAO"/>
    -->
    <!-- Util Class -->
    <property name="mediaFileManagement" ref="mediaFileManagement"/>
    
  </bean>
  
  
  <!-- image upload controller 
  <bean name="/uploadImage" class="org.inbio.m3s.web.controller.ImageUploadController">
    <property name="commandClass" value="org.inbio.m3s.FileUploadBean"/>
    <property name="formView" value="insertStep1"/>
    <property name="successView" value="redirect:saveImage.html"/>
    <property name="filePath" value="/usr/share/tomcat5.5/webapps/m3sINBioFiles/TEMP_MEDIA_DIR/"/>
    <property name="fileName" value="laPrueba2.jpg"/>
  </bean>
  -->
    

  <!-- uploads jpg or excel files controller -->
  <bean name="/uploadFile.html" class="org.inbio.m3s.web.controller.UploadFileController">
    <property name="commandClass" value="org.inbio.m3s.FileUploadBean"/>
    <property name="formView" value="insertStep1"/>
    
    <property name="posibleSuccessViewMap">
      <map>
        <entry key="jpgImage" value="redirect:saveImage.html"/>
        <entry key="excel" value="redirect:excel.html"/>
      </map>
    </property>
    <property name="posibleFileExtensionMap">
      <map>
        <entry key="jpgImage" value="jpg"/>
        <entry key="excel" value="xls"/>
      </map>
    </property>
        
    <!--<property name="filePath" value="/usr/share/tomcat5.5/webapps/m3sINBioFiles/TEMP_MEDIA_DIR/"/>-->
    <!--<property name="filePath" value="/var/www/lucina.inbio.ac.cr/webapps/m3sINBioFiles/TEMP_MEDIA_DIR/"/>-->
    <property name="filePath" value="/mnt/m3sImages/INBio/TEMP_MEDIA_DIR/"/>
    <property name="metadataFileName" value="fileName"/>
    <property name="metadataUsername" value="username"/>
    <property name="metadataFileType" value="fileType"/>
  </bean>  
  
  <!-- image dispatcher -->
  <bean name="/getImage" class="org.inbio.m3s.web.controller.ImageController">
    <property name="mediaDAO" ref="mediaDAO"/>
    <property name="applicationPath" value="/mnt/m3sImages/INBio/"/>
    <property name="temporalFilesPath" value="TEMP_MEDIA_DIR/"/>
    <property name="mediaFilesPath" value="MEDIA/"/>
    
    <property name="thumbImagePath" value="THUMB"/>
    <property name="bigImagePath" value="BIG"/>
    <property name="thumbImageCode" value="1"/>
    <property name="bigImageCode" value="2"/>
    
    
    
  </bean> 
  
  <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
    <!-- one of the properties available; the maximum file size in bytes -->
    <property name="maxUploadSize">
      <value>10485760</value>
    </property>
  </bean>  
  <!-- <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"/> -->
  <!-- 
    <bean id="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
        <property name="mappings">
            <props>
                <prop key="/upload.form">fileUploadController</prop>
            </props>
        </property>
    </bean>
 -->
  
	
  <!-- externalized messages -->
  <bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
    <property name="basenames">
      <list>
        <value>messages</value>
        <!-- aca se pueden agregar otros 'values' correspondientes a archivos de internationalizacion-->
      </list>
    </property>
  </bean>
  
  <!-- tiles configurer -->
  <bean id="tilesConfigurer" class="org.springframework.web.servlet.view.tiles.TilesConfigurer">
    <property name="definitions">
      <list>
        <value>/WEB-INF/m3s-tiles.xml</value>
      </list>
    </property>
  </bean>
  
  <!--Resolves the theme-->
  <bean id="themeResolver" class="org.springframework.web.servlet.theme.CookieThemeResolver">
    <property name="defaultThemeName" value="inbio2"/>
    <property name="cookieName" value="m3sTheme"/>
    <property name="cookieMaxAge" value ="2147483647"/>
  </bean>
  <bean id="themeSource" class="org.springframework.ui.context.support.ResourceBundleThemeSource">
    <property name="basenamePrefix" value="theme-"/>
  </bean>  
  
  <bean name="/login.html" class="org.inbio.m3s.web.controller.LoginPageController">
    <!-- View -->
    <property name="viewName" value="login"/>
    <!--  Form Action -->
    <!--  arreglar esto 
    <property name="formActionValue" value="saveMetadata.html"/>
    -->
  	<!--  metadata 
    <property name="metadataSserName" value="userName"/>
    <property name="metadataPassword" value="password"/>
    -->  
       
    <!-- Managers  
    <property name="messageManager" ref="messageManager"/>	
    -->
  </bean>
  
  <!--  Este bean se encargará de manejar TODAS las excepciones -->
  <bean id="handler1" class="org.inbio.m3s.web.exception.handler.GenericExceptionHandler"/>
  
  <!--  Este bean apoya en la búsqueda de metadatos -->
  <bean id="metadataHandler" class="org.inbio.m3s.web.controller.metadata.MetadataHandler">
    <!-- metadata values -->
    <property name="metadataMediaTypes" value="mediaTypes"/>
    <property name="metadataAssociatedToValues" value="associatedToValues"/>
    <property name="metadataUsePolicies" value="usePolicies"/>
    <!--  Owner Widget configuration -->
    <property name="mediaOwnerFilters" ref="mediaOwnerFilters"/>
    <property name="mediaOwnerFiltersRequestKey" value="mediaOwnerFilters"/>
    
    <!-- Managers  -->  
    <property name="messageManager" ref="messageManager"/>  
    <!-- ARA 
    <property name="mediaManager" ref="ARAMediaManager"/>
    <property name="taxonomyManager" ref="ARATaxonomyManager"/>
    <property name="agentManager" ref="ARAAgentManager"/>
    -->
    <!-- ATTA 
    <property name="mediaManager" ref="ATTAMediaManager"/>
    <property name="taxonomyManager" ref="ATTATaxonomyManager"/>
    <property name="agentManager" ref="ATTAAgentManager"/>
    -->
  </bean>
  
</beans>
